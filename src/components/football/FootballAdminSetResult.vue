<template>
  <PreLoader v-if="loader"></PreLoader>
    <div class="prognosis_block">
      <div class="part_block">
        <div class="title_block">
          <div class="item icon">{{ icons[1] }}</div>
          <div class="item title">{{ title[1] }}:</div>
        </div>
        <div class="value_block">
          <div class="goal_block">
            <div class="zero goal_btn" @click="setGoals('zero', 7)">0</div>
            <div class="minus goal_btn" @click="setGoals('minus', 7)">-</div>
            <div class="value">{{ data[7] }}</div>
            <div class="plus goal_btn" @click="setGoals('plus', 7)">+</div>
            <div class="two goal_btn" @click="setGoals('two', 7)">2</div>
          </div>
          <div class="dash">‚Äì</div>
          <div class="goal_block">
            <div class="zero goal_btn" @click="setGoals('zero', 8)">0</div>
            <div class="minus goal_btn" @click="setGoals('minus', 8)">-</div>
            <div class="value">{{ data[8] }}</div>
            <div class="plus goal_btn" @click="setGoals('plus', 8)">+</div>
            <div class="two goal_btn" @click="setGoals('two', 8)">2</div>
          </div>
        </div>

      </div>
      <div class="prognosis_dash_line"></div>

      <div class="part_block">
        <div class="title_block block_absolute">
          <div class="item icon">{{ icons[9] }}</div>
          <div class="item title">{{ title[9] }}:</div>
        </div>
        <div class="value_block">
          <div class="value_box">
            <div class="match_result_el" :class="{'active' : data[9] === '–ø1'}" @click="setResult('–ø1')">–ø1</div>
            <div class="match_result_el" :class="{'active' : data[9] === '–Ω'}" @click="setResult('–Ω')">–Ω</div>
            <div class="match_result_el" :class="{'active' : data[9] === '–ø2'}" @click="setResult('–ø2')">–ø2</div>
          </div>
        </div>
      </div>
      <div class="prognosis_dash_line"></div>

      <div class="part_block">
        <div class="title_block block_absolute">
          <div class="item icon">{{ icons[25] }}</div>
          <div class="item title">{{ title[25] }}:</div>
        </div>
        <div class="value_block">
          <div class="minus math_btn" @click="setMath('minus', 25, 'sum')">-</div>
          <div class="value">{{ data[25] }}</div>
          <div class="plus math_btn" @click="setMath('plus', 25, 'sum')">+</div>
        </div>
      </div>

      <div class="prognosis_dash_line"></div>

      <div class="part_block">
        <div class="title_block block_absolute">
          <div class="item icon">{{ icons[26] }}</div>
          <div class="item title">{{ title[26] }}:</div>
        </div>
        <div class="value_block">
          <div class="minus math_btn" @click="setMath('minus', 26)">-</div>
          <div class="value">{{ data[26] }}</div>
          <div class="plus math_btn" @click="setMath('plus', 26)">+</div>
        </div>
      </div>
      <div class="prognosis_dash_line"></div>
      <div class="part_block">
        <div class="title_block">
          <div class="item icon">{{ icons[10] }}</div>
          <div class="item title">{{ title[10] }}:</div>
        </div>
        <div class="value_block">
          <div class="match_domination_box">
            <div class="minus math_btn" @click="setRangeBtn('plus')">+</div>
            <div class="value left">{{ data[10] }}</div>
            <input class="domination_range" type="range" ref="iRange" :value="data[10]" @change="rangeChange()">
            <div class="value right">{{ 100 - data[10] }}</div>
            <div class="plus math_btn" @click="setRangeBtn('minus')">+</div>
            <div class="plus math_btn" @click="setRangeBtn('half')">50</div>
          </div>
        </div>
      </div>
      <div class="prognosis_dash_line"></div>
      <div class="part_block yellow">
        <div class="title_block block_absolute">
          <div class="item icon">{{ icons[12] }}</div>
          <div class="item title">{{ title[12] }}:</div>
        </div>
        <div class="value_block">
          <div class="box">
            <div class="btn" @click="setValue('zero', 12)">0</div>
            <div class="btn" @click="setValue('minus', 12)">-</div>
            <div class="value">{{ data[12] }}</div>
            <div class="btn" @click="setValue('plus', 12)">+</div>
            <div class="btn" @click="setValue('five', 12)">5</div>
          </div>
        </div>
      </div>
      <div class="prognosis_dash_line"></div>
      <div class="part_block red">
        <div class="title_block block_absolute">
          <div class="item icon">{{ icons[13] }}</div>
          <div class="item title">{{ title[13] }}:</div>
        </div>
        <div class="value_block">
          <div class="box">
            <div class="btn" @click="setValue('zero', 13)">0</div>
            <div class="btn" @click="setValue('minus', 13)">-</div>
            <div class="value">{{ data[13] }}</div>
            <div class="btn" @click="setValue('plus', 13)">+</div>
            <div class="btn" @click="setValue('one', 13)">1</div>
          </div>
        </div>
      </div>
      <div class="prognosis_dash_line"></div>
      <div class="part_block">
        <div class="title_block block_absolute">
          <div class="item icon">{{ icons[11] }}</div>
          <div class="item title">{{ title[11] }}:</div>
        </div>
        <div class="value_block">
          <div class="box">
            <div class="btn" @click="setValue('zero', 11)">0</div>
            <div class="btn" @click="setValue('minus', 11)">-</div>
            <div class="value">{{ data[11] }}</div>
            <div class="btn" @click="setValue('plus', 11)">+</div>
            <div class="btn" @click="setValue('six', 11)">6</div>
            <div class="btn" @click="setValue('twelve', 11)">12</div>
          </div>
        </div>
      </div>
      <div class="prognosis_dash_line"></div>
      <div class="part_block">
        <div class="title_block block_absolute">
          <div class="item icon">{{ icons[14] }}</div>
          <div class="item title">{{ title[14] }}:</div>
        </div>
        <div class="value_block">
          <div class="box">
            <div class="btn" @click="setValue('zero', 14)">0</div>
            <div class="btn" @click="setValue('minus', 14)">-</div>
            <div class="value">{{ data[14] }}</div>
            <div class="btn" @click="setValue('plus', 14)">+</div>
            <div class="btn" @click="setValue('one', 14)">1</div>
          </div>
        </div>
      </div>

      <div class="prognosis_dash_line"></div>

      <div class="play_off_block" v-if="stage==='–ü–ª–µ–π-–æ—Ñ—Ñ'">
        <div class="part_block">
          <div class="title_block block_absolute">
            <div class="item icon">{{ icons[47] }}</div>
            <div class="item title">{{ title[47] }}:</div>
          </div>
          <div class="value_block">
            <div class="box">
              <div class="match_result_el play_off_el" :class="{'active' : data[47] === '–ë—É–¥–µ—Ç'}"
                   @click="setPlayOffResult(47,'–ë—É–¥–µ—Ç')">–ë—É–¥–µ—Ç
              </div>
              <div class="match_result_el play_off_el" :class="{'active' : data[47] === '–ù–µ –±—É–¥–µ—Ç'}"
                   @click="setPlayOffResult(47, '–ù–µ –±—É–¥–µ—Ç')">–ù–µ –±—É–¥–µ—Ç
              </div>
            </div>
          </div>
        </div>

        <div class="prognosis_dash_line"></div>

        <div class="part_block">
          <div class="title_block block_absolute">
            <div class="item icon">{{ icons[48] }}</div>
            <div class="item title">{{ title[48] }}:</div>
          </div>
          <div class="value_block">
            <div class="box">
              <div class="match_result_el play_off_el" :class="{'active' : data[48] === '–ë—É–¥–µ—Ç'}"
                   @click="setPlayOffResult(48,'–ë—É–¥–µ—Ç')">–ë—É–¥–µ—Ç
              </div>
              <div class="match_result_el play_off_el" :class="{'active' : data[48] === '–ù–µ –±—É–¥–µ—Ç'}"
                   @click="setPlayOffResult(48,'–ù–µ –±—É–¥–µ—Ç')">–ù–µ –±—É–¥–µ—Ç
              </div>
            </div>
          </div>
        </div>
        <div class="prognosis_dash_line"></div>
      </div>


      <div class="btns_block">

        <div class="btn_send" @click="sendResult">–ó–∞–ø–æ–ª–Ω–∏—Ç—å</div>

      </div>

      <div class="btn_set_result" @click="calcResult">–†–∞—Å—Å—á–∏—Ç–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã</div>
    </div>

    <div class="error_message" v-if="error">{{ error }}</div>
</template>

<script>
import {mapActions, mapState} from "vuex";
import PreLoader from "@/components/main/PreLoader";

export default {
  name: "FootballAdminSetResult",
  components: {
    PreLoader
  },
  props: {
    id: {
      type: Number
    },
    stage: {
      type: String
    },
    result: {
      type: Object
    }
  },
  data() {
    return {

      loader: false,
      error: '',

      data: {        
        7: this.result.goal_home ?? 0, // goals_home
        8: this.result.goal_guest ?? 0, // goals_guest
        9: this.result.result ?? '', // –ò—Å—Ö–æ–¥ –º–∞—Ç—á–∞

        25: this.result.diff ?? '', // –†–∞–∑–Ω–∏—Ü–∞ –º—è—á–µ–π
        26: this.result.sum ?? '', // –°—É–º–º–∞ –≥–æ–ª–æ–≤
        10: this.result.domination ?? 50, // –í–ª–∞–¥–µ–Ω–∏–µ
        12: this.result.yellow ?? '', // –∂–µ–ª—Ç—ã—Ö
        13: this.result.red ?? '', // –∫—Ä–∞—Å–Ω—ã—Ö

        11: this.result.corner ?? '', // —É–≥–ª–æ–≤—ã—Ö
        14: this.result.penalty ?? '', // –ø–µ–Ω–∞–ª—å—Ç–∏

        47: this.result.otime ?? '', // m_otime
        48: this.result.spenalty ?? '', // m_spenalty

        27: '', // m_offside
      },

      icons: {
        1: '0-0',
        9: '‚úì',  // result
        25: 'Œî',
        26: 'Œ£',
        10: 'ü°ò',
        12: '‚ñÆ',
        13: '‚ñÆ',
        11: 'ü°¨',
        14: '‚óí',
        47: '+‚óî',
        48: '+‚óí',
      },

      title: {
        1: '–°—á–µ—Ç –º–∞—Ç—á–∞',
        9: '–ò—Å—Ö–æ–¥ –º–∞—Ç—á–∞',
        25: '–†–∞–∑–Ω–∏—Ü–∞ –º—è—á–µ–π',
        26: '–°—É–º–º–∞ –º—è—á–µ–π',
        10: '–ü—Ä–æ—Ü–µ–Ω—Ç –≤–ª–∞–¥–µ–Ω–∏—è',
        12: '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∂–µ–ª—Ç—ã—Ö',
        13: '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫—Ä–∞—Å–Ω—ã—Ö',
        11: '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–≥–ª–æ–≤—ã—Ö',
        14: '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–µ–Ω–∞–ª—å—Ç–∏',
        47: '–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –≤—Ä–µ–º—è',
        48: '–°–µ—Ä–∏—è –ø–µ–Ω–∞–ª—å—Ç–∏',
      },

      description: {
        1: '–°—á–µ—Ç –º–∞—Ç—á–∞',
        9: '–ò—Å—Ö–æ–¥ –º–∞—Ç—á–∞ (–ø1 - –ø–æ–±–µ–¥–∞ –ø–µ—Ä–≤–æ–π –∫–æ–º–∞–Ω–¥—ã, –Ω - –Ω–∏—á—å—è, –ø2 - –ø–æ–±–µ–¥–∞ –≤—Ç–æ—Ä–æ–π)',
        25: '–†–∞–∑–Ω–∏—Ü–∞ –º—è—á–µ–π –∑–∞–±–∏—Ç—ã–µ –≤—Ç–æ—Ä–æ–π –∫–æ–º–∞–Ω–¥–æ–π –≤—ã—á–∏—Ç–∞—é—Ç—Å—è –∏–∑ –∑–∞–±–∏—Ç—ã—Ö –ø–µ—Ä–≤–æ–π –∫–æ–º–∞–Ω–¥–æ–π',
        26: '–°—É–º–º–∞ –º—è—á–µ–π –∑–∞–±–∏—Ç—ã—Ö –æ–±–µ–∏–º–∏ –∫–æ–º–∞–Ω–¥–∞–º–∏',
        10: '–ü—Ä–æ—Ü–µ–Ω—Ç –≤–ª–∞–¥–µ–Ω–∏—è –º—è—á–æ–º –ø–µ—Ä–≤–æ–π –∏ –≤—Ç–æ—Ä–æ–π –∫–æ–º–∞–Ω–¥–æ–π',
        12: '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∂–µ–ª—Ç—ã—Ö –∫–∞—Ä—Ç–æ—á–µ–∫ –≤ –º–∞—Ç—á–µ (—Å—É–º–º–∞ –¥–ª—è –æ–±–µ–∏—Ö –∫–æ–º–∞–Ω–¥)',
        13: '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫—Ä–∞—Å–Ω—ã—Ö –∫–∞—Ä—Ç–æ—á–µ–∫ –≤ –º–∞—Ç—á–µ (—Å—É–º–º–∞ –¥–ª—è –æ–±–µ–∏—Ö –∫–æ–º–∞–Ω–¥)',
        11: '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–≥–ª–æ–≤—ã—Ö –≤ –º–∞—Ç—á–µ (—Å—É–º–º–∞ –¥–ª—è –æ–±–µ–∏—Ö –∫–æ–º–∞–Ω–¥)',
        14: '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–µ–Ω–∞–ª—å—Ç–∏ –≤ –º–∞—Ç—á–µ (—Å—É–º–º–∞ –¥–ª—è –æ–±–µ–∏—Ö –∫–æ–º–∞–Ω–¥)',
        47: '–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –≤—Ä–µ–º—è (–Ω–∞–ª–∏—á–∏–µ/–æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ)',
        48: '–°–µ—Ä–∏—è –ø–µ–Ω–∞–ª—å—Ç–∏ (–Ω–∞–ª–∏—á–∏–µ/–æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ)',

      }
    }
  },

  methods: {
    ...mapActions({
      sendFootballResult: 'admin/setFootballResult',
      calcFootballResult: 'admin/calcFootballResult'
    }),

    setGoals(type, id) {

      if (type === 'minus') {
        if (this.data[id] > 0) this.data[id]--
      }

      if (type === 'plus') this.data[id]++

      if (type === 'zero') this.data[id] = 0
      if (type === 'two') this.data[id] = 2
      if (type === 'five') this.data[id] = 5

      this.data[26] = Number(this.data[7]) + Number(this.data[8])

      this.data[25] = Number(this.data[7]) - Number(this.data[8])

      if (this.data[25] > 0) this.data[9] = '–ø1'
      if (this.data[25] === 0) this.data[9] = '–Ω'
      if (this.data[25] < 0) this.data[9] = '–ø2'

    },

    setMath(operation, id, type = '') {
      if (operation === 'minus') {
        if (type === 'sum') {
          if (this.data[id] > 0) this.data[id]--
        } else {
          this.data[id]--
        }
      }

      if (operation === 'plus') this.data[id]++
    },

    setResult(res) {
      this.data[9] = res
    },

    setPlayOffResult(id, res) {
      this.data[id] = res
    },

    rangeChange() {
      this.data[10] = this.$refs.iRange.value
    },

    setValue(type, id) {

      if (type === 'minus') {
        if (this.data[id] > 0) this.data[id]--
      }

      if (type === 'plus') this.data[id]++

      if (type === 'zero') this.data[id] = 0
      if (type === 'one') this.data[id] = 1
      if (type === 'five') this.data[id] = 5
      if (type === 'six') this.data[id] = 6
      if (type === 'twelve') this.data[id] = 12

    },

    setRangeBtn(type) {
      if (type === 'minus') {
        if (this.data[10] > 0) this.data[10]--
      }

      if (type === 'plus') {
        if (this.data[10] < 101) this.data[10]++
      }

      if (type === 'half') this.data[10] = 50
    },

    async sendResult() {
      this.loader = true
      this.queryEvent.userToken = this.token
      this.queryEvent.role = this.role
      this.queryEvent.matchId = this.id
      this.queryEvent.data = this.data

      await this.sendFootballResult()

      this.loader = false
    },

    async calcResult(){
      this.loader = true

      this.queryEvent.userToken = this.token
      this.queryEvent.role = this.role
      this.queryEvent.matchId = this.id

      await this.calcFootballResult()

      this.loader = false
    }
  },

  computed: {
    ...mapState({
      token: state => state.auth.authData.token,
      queryEvent: state => state.admin.queryEvent,
      role: state => state.auth.userInfo.role,
    })
  },
}
</script>

<style lang="less" scoped>
@import "src/assets/css/variables.less";
.prognosis_btn {
  background: @YesWrite;

  .flex_center;
  background: @colorText2;
  color: @colorText;
  cursor: pointer;
  .shadow_template;
  padding: 2px 2px;
  font-size: 14px;
  border-radius: 3px;
  text-align: center;
  border: 1px solid transparent;
  text-decoration: none;
}
.prognosis_block {
  background: @red;
  color: @colorText;
  padding: 4px;
  border-radius: 5px;

  display: flex;
  flex-direction: column;

  gap: 4px;

  .part_block {
    position: relative;
    width: 100%;
    display: flex;
    flex-direction: column;
    gap: 4px;

    .title_block {
      display: flex;
      flex-direction: row;
      gap: 4px;
      .item{
        .shadow_inset;
        text-align: left;
        color: @maxdarkgrey;
        font-size: 14px;
        font-weight: 700;
      }
      .icon{
        min-width: 24px;
        .flex_center;
      }
    }

    .value_block {
      width: 100%;
      display: flex;
      flex-direction: row;
      justify-content: flex-end;
      gap: 4px;

      .value_box {
        display: flex;
        flex-direction: row;
        gap: 4px;
      }
    }

    &.yellow {
      .item {
        color: @maxYellow;
      }

      .value {
        border-color: @maxYellow;
      }

      .btn {
        background: @maxYellow;
      }
    }

    &.red {
      .item {
        color: @maxred;
      }

      .value {
        border-color: @maxred;
      }

      .btn {
        background: @maxred;
      }
    }
  }

  .block_absolute{
    position: absolute;
  }

  .prognosis_dash_line {
    width: 100%;
    border-bottom: 1px dotted @maxdarkgrey;
  }

  .goal_block {
    display: flex;
    flex-direction: row;
    align-items: center;
    gap: 3px;

    .value {
      .flex_center;
      .shadow_inset;
      width: 19px;
      height: 19px;
      border: 2px solid @YesWrite;
      padding: 2px 2px;
      font-size: 14px;
      border-radius: 3px;
    }

    .goal_btn {
      width: 20px;
      height: 20px;
      background: @YesWrite;

      .flex_center;
      background: @colorText2;
      color: @colorText;
      cursor: pointer;
      .shadow_template;
      padding: 2px 2px;
      font-size: 14px;
      border-radius: 3px;
      text-align: center;
      border: 1px solid transparent;
      text-decoration: none;
    }
  }

  .match_result_el {
    .flex_center;
    .shadow_inset;
    cursor: pointer;
    padding: 0;
    width: 26px;
    height: 26px;
    font-size: 12px;
    border: 2px solid @maxdarkgrey;

    &.active {
      border-color: @YesWrite;
    }
  }

  .play_off_el{
    width: 65px;
  }

  .math_btn {
    width: 26px;
    height: 26px;
    background: @YesWrite;

    .flex_center;
    background: @colorText2;
    color: @colorText;
    cursor: pointer;
    .shadow_template;
    padding: 2px 2px;
    font-size: 14px;
    border-radius: 3px;
    text-align: center;
    border: 1px solid transparent;
    text-decoration: none;
  }

  .value {
    .flex_center;
    .shadow_inset;
    width: 26px;
    height: 26px;
    border: 2px solid @YesWrite;
    padding: 2px 2px;
    font-size: 14px;
    border-radius: 3px;
  }

  .match_domination_box {
    display: flex;
    flex-direction: row;
    gap: 3px;

    .domination_range {
      width: 114px;
      max-width: 59.8%;
    }

    .value {
      width: 26px;
      height: 26px;
    }

    .math_btn {
      .prognosis_btn;
      width: 26px;
      height: 26px;
    }
  }
  .box {
    display: flex;
    flex-direction: row;
    gap: 3px;
  }
  .btn {
    .prognosis_btn;
    width: 26px;
    height: 26px;
  }


  &.yellow {
    .title {
      color: @maxYellow;
    }

    .value {
      border-color: @maxYellow;
    }

    .btn {
      background: @maxYellow;
    }
  }

  &.red {
    .title {
      color: @maxred;
    }

    .value {
      border-color: @maxred;
    }

    .btn {
      background: @maxred;
    }
  }

  .btns_block {
    display: flex;
    flex-direction: row;
    justify-content: space-between;

    margin-top: 10px;

    .other_match_btn {
      .prognosis_btn;
      width: 19px;
      height: 19px;
    }

    .inactive{
      background: @colorBlur;
      border: 2px solid crimson;
    }

    .annotation_btn {
      position: relative;
      .prognosis_btn;
      width: 140px;
      max-width: 40%;
      background: @kerling;

      .annotation_arrow {
        position: absolute;
        right: 5px;

        &.up {
          transform: rotate(-90deg);
        }
      }
    }

    .btn_send {
      .prognosis_btn;
      width: 140px;
      max-width: 40%;

      &.rewrite {
        background: @NoWrite;
      }
    }
  }
}

.error_message {
  margin-top: 4px;
  width: 100%;
  padding: 4px 2px;
  border: 1px solid @warning;
  color: @warning;
  border-radius: 6px;
}

.btn_set_result {
  display: flex;
  flex-direction: column;
  justify-content: center;
  background: @red;
  color: @colorText;
  cursor: pointer;
  .shadow_template;
  padding: 2px 2px;
  font-size: 10px;
  border-radius: 3px;
  text-align: center;
  border: 1px solid transparent;
  text-decoration: none;
  margin-top: 8px;
  margin-bottom: 38px;
}
</style>